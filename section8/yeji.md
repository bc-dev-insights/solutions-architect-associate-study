## Section 8. 고가용성 및 스케일링성 : ELB 및 ASG

### Vertical Scalability(수직 확장성)

- 인스턴스의 크기를 확장하는 것을 의미함.
- 예를들어 EC2를 쓸 때 애플리케이션이 t2.micro로 구동된다면 이 애플리케이션을 확장해서 t2.large에서 구동하게 끔 만들고자 하는 것.
- 수직 확장성은 하드웨어에 제한이 걸려있음.

### Horizontal Scalability(수평 확장성)

- 애플리케이션에서 인스턴스나 시스템의 수를 늘리는 방법.

### High Availability(고가용성)

- 애플리케이션 또는 시스템을 적어도 둘 이상의 AWS의 AZ나 데이터 센터에서 가동 중인 걸 의미
- 고가용성의 목표는 데이터 센터에서의 손실에서 살아남는 것을 의미
- 센터하나가 멈춰도 계속 작동이 가능하게끔 하는 것

### ELB(Elastic Load Balancing)

- 로드 밸런서는 서버 혹은 서버셋으로 트래픽을 백엔드나 다운스트림 EC2 인스턴스 또는 서버들로 전달하는 역할을 합니다
- 부하를 다수의 다운스트림 인스턴스로 분산하기 위해 로드밸런서가 필요함
- 애플리케이션에 단일 액세스 지점(DNS)을 노출
- 다운스트림의 인스턴스 장애를 원활히 처리할 수 있음
- 로드 밸런서가 상태 확인 매커니즘으로 어떤 인스턴스로 트래픽을 보낼 수 없는지 확인해줌
- SSL 종료도 할 수 있어서 웹 사이트에 암호화된 HTTPS 트래픽을 가질 수 있음
- 쿠키로 고정도를 강화할 수 있고 영역에 걸친 고가용성을 가짐
- 클라우드 내에서 개인 트래픽과 공공 트래픽을 분리 가능

1. 로드밸런서를 사용하는 이유
- ELB는 관리형 로드밸런서임.
    - AWS가 관리하며 어떤 경우에도 작동할 것을 보장함.
    - AWS가 업그레이드와 유지 관리 및 고가용성을 책임지며 로드 밸런서의 작동 방식을 수정할 수 있게끔 일부 구성 놉도 제공함.
    - 자체 로드밸런서를 마련하는 것보다 저렴하면서 확장성 측면에서도 좋음.

1. Health Check
- 일래스틱 로드 밸런서가 EC2 인스턴스의 작동이 올바르게 되고 있는지의 여부를 확인하기 위해 사용
- 만약 제대로 작동하는 중이 아니라면 해당 인스턴스로는 트래픽을 보낼 수 없기 때문에 로드 밸런서에겐 인스턴스의 상태가 아주 중요하죠 그리고 상태 확인은 포트와 라우트에서 이뤄짐

1. 로드밸런서 종류 (ALB, NLB, GWLB)
- ALB

HTTP, HTTPS와 WebSocket 프로토콜을 지원하죠

- NLB

TCP, TLS, secure TCP와 UDP 프로토콜을 지원하죠

- GWLB(게이트웨이 로드밸런서)

네트워크층에서 작동하므로 3계층과 IP 프로토콜에서 작동함

### ALB (Application Load Balancer)

- 7계층, 즉 HTTP 전용 로드 밸런서로 머신 간 다수 HTTP 애플리케이션의 라우팅에 사용됨
- 머신들은 대상 그룹이라는 그룹으로 묶임
- 동일 EC2 인스턴스 상의 여러 애플리케이션에 부하를 분산함 (컨테이너, ECS 사용)
- HTTP/2와 WebSocket 지원
- HTTP에서 HTTPS로 트래픽을 자동 리다이렉트하려는 경우 로드 밸런서 레벨에서 가능하
- 경로 라우팅 지원

URL 대상 경로에 기반한 라우팅이 가능

ex) [example.com/users나](http://example.com/users%EB%82%98) [example.com/posts같은](http://example.com/posts%EA%B0%99%EC%9D%80) 경우

/users와 /posts는 URL 상의 서로 다른 경로이고 이들을 다른 대상 그룹에 리다이렉트 할 수 있음

URL의 호스트 이름에 기반한 라우팅도 가능

[one.example.com](http://one.example.com/) 또는 other.example.com에 접근이 가능하다고 하면 두 개의 다른 대상 그룹에 라우팅이 될 수 있음

- 포트 매핑 기능이 있어 ECS 인스턴스의 동적 포트로의 리다이렉션을 가능하게 해 도커와 ECS 경우 ALB가 적합한 로드밸런서임
- 

### GWLB(Gateway Load Balancer)

GWLB는 배포 및 확장과 AWS의 타사 네트워크 가상 어플라이언스의 플릿 관리에 사용

- GWLB는 네트워크의 모든 트래픽이 방화벽을 통과하게 하거나 침입 탐지 및 방지 시스템에 사용
- IDPS나 심층 패킷 분석 시스템 또는 일부 페이로드를 수정할 수 있지만 네트워크 수준에서 가능
- Layer3계층에서 동작함 - IP Packets
- 6081번 포트의 GENEVE 프로토콜 사용
1. 대상 그룹
- EC2 인스턴스
- IP 주소 - private IP이여야만 함

### Stickey Sessions (Session Affinity)

 로드 밸런서에 2가지 요청을 수행하는 클라이언트가 요청에 응답하기 위해 백엔드에 동일한 인스턴스를 갖는 것

고정세션 - Cookie Names

1. Application-based Cookies
- 사용자 정의 쿠키로 애플리케이션에서 생성됨
- 애플리케이션에 필요한 모든 사용자 정의 속성을 포함할 수 있음
- 쿠키 이름은 각 대상 그룹별로 개별적으로 지정
    - AWSALB, AWSALBAPP, AWSALBTG 해당 이름은 사용하지 못함(ELB에서 사용중)
1. Duration-based Cookies
- 로드밸런서에서 생성되는 쿠키
- 측정 기간을 기반으로 만료되며 그 기간이 로드밸런서 자체에서 생성
- ALB에서는 AWSALB, CLB에서는 AWSELB라고 부름
